# Use a small Node LTS base image
FROM node:22-alpine

# Enable pnpm via corepack
ENV PNPM_HOME=/root/.local/share/pnpm
ENV PATH=$PNPM_HOME:$PATH
RUN corepack enable

WORKDIR /app

# Install deps using lockfile for reproducible builds
COPY package.json pnpm-lock.yaml* ./
RUN pnpm install --frozen-lockfile

# Copy source
COPY . .

# Production mode
ENV NODE_ENV=production

# App listens on port 80 inside the container
EXPOSE 80

# Start the server (reads PORT/HOST from env)
CMD ["pnpm", "start"]
